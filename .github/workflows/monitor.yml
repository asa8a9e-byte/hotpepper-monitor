  name: ホットペッパー新規店舗監視

  on:
    schedule:
      - cron: '*/15 * * * *'
    workflow_dispatch:

  jobs:
    monitor:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4
        - uses: actions/setup-python@v5
          with:
            python-version: '3.11'
        - run: pip install -r requirements.txt
        - uses: dawidd6/action-download-artifact@v3
          with:
            name: salon-data
            path: .
            search_artifacts: true
            if_no_artifact_found: ignore
        - run: python main.py
          env:
            CHATWORK_API_TOKEN: ${{ secrets.CHATWORK_API_TOKEN }}
            CHATWORK_ROOM_ID: ${{ secrets.CHATWORK_ROOM_ID }}
            GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
            SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}
        - uses: actions/upload-artifact@v4
          with:
            name: salon-data
            path: known_salons.json
            retention-days: 90
            overwrite: true

